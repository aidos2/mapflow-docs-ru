
Пользовательский интерфейс web-приложения Mapflow 
===================================================

Откройте web-приложение `Mapflow <https://app.mapflow.ai>`_. Зарегистрируйте новый аккаунт или войдите, используя аккаунт Google.

Как запускать обработку 
------------------------

Пользоваться платформой просто. Ниже отражен и описан пошаговый процесс запуска обработки: 

.. figure:: _static/ui_flow_basic.png
  :alt: UI Mapflow – run flow
  :align: center
  :width: 15cm

1. Источник данных
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   
1.1. Выбор источника данных
"""""""""""""""""""""""""""
   
   - Default

    По умолчанию Mapflow использует спутниковые снимки `Mapbox Satellite <https://mapbox.com/maps/s satellite>`_. Вы можете загрузить собственный файл в формате `GeoJSON <https://geojson.org>`_, либо нарисовать область прямо на карте (*«Нарисовать прямоугольник»*).

   - URL

  .. figure:: _static/select_custom_xyz.png
   :alt: Select custom XYZ
   :align: center
   :width: 9cm

  
  Интерфейс данной вкладки позволяет:

    * Указать XYZ ссылку на источник снимков. Ссылка автоматически проверяется на валидность;
    * Если тип источника поддерживает стандарт TMS, т.е. у него перевернуто начало Y координаты - выбрать соответствующую настройку;
    * Задать масштаб (Zoom), на котором будет производится обработка. Все модели Mapflow имеют свое рекомендуемое разрешение входящих снимков (см на страничке :doc:`Описание моделей <pipelines>`), но иногда может быть полезно поиграться с масштабами и сравнить результаты;
    * Вернуться к дефолтному источнику.

  .. important:: 
    В настоящее время, в качестве исходных данных, мы поддерживаем только RGB-снимки. По умолчанию Mapflow использует спутниковые снимки `Mapbox Satellite <https://mapbox.com/maps/satellite>`_. Для того, чтобы загрузить свой GeoTIFF, используйте `API <../docs_api/processing_api>`_ или 
    `плагин Mapflow для QGIS <../docs_api/qgis_mapflow>`_.


1.2. Выбор области обработки
""""""""""""""""""""""""""""

  .. figure:: _static/ui_map_select_source.png
   :alt: Select custom XYZ
   :align: center
   :width: 15cm

  На данной вкладке производится добавление области обработки. Пользователь может наприсовать область с помощью прямоугольной рамки или загрузить в формате GeoJSON (нарисовать и скачать, а также посмотреть структуру данных можно по этой ссылке - `geojson.io <http://geojson.io/>`_). 

 .. attention:: 
  В пользовательском приложении платформы Mapflow для каждой обработки может быть нарисована или загружена только одна область. Если ваш GeoJSON имеет несколько полигонов в составе FeatureCollection, будет использован только первый из них. Если вы хотите обработать несколько областей, вы можете разделить их на отдельные файлы и запустить обработку для каждого. Пакетная обработка в данный момент доступна при использовании `API <../docs_api/processing_api>`_ платформы.

  
2. AI модель
^^^^^^^^^^^^
 Выберите одну из доступных моделей обработки (:doc:`См. подробное описание моделей <pipelines>`).


3. Пост-обработка
^^^^^^^^^^^^^^^^^

 На данном шаге интерфейс Mapflow позволяет выбрать дополнительные параметры обработки. В зависимости от того, какую AI модель вы выбрали, доступны различные функции пост-обработки.
 
 Для AI модели "Здания": 
 
 * *"Классификация"* по типам зданий - типология зданий представлена основными классами: многоквартирные дома, частный сектор, промышеленные зоны, коммерческая недвижимость, иные нежилые (см. `Urban Mapping - Классификация <../docs_um/classes>`_).
 
 * *"Склейка с OSM"* - замена данных на здания с Openstreetmap по пространственному наложению. Для более наглядного визуального результата автоматические полигоны после обработки сопоставляются с полигонами зданий из OSM, а далее, путем сравнения с порогом соответствия по площади, производится замена некоторых автоматических полигонов.
 
 * *"Полигонизация"* - выделение контуров зданий и присвоение и замена сложных полигонов на геометрические примитивы.

 * *"Высоты зданий"* - Определение высоты зданий по косвенным признакам - длине тени и видимой части стены. Сдвиг на основание.

  .. important::
   Опция *Высоты зданий* доступна при обработке свыше 50 кв. км.

 Для AI модели "Лес": 
  
 * *"Высоты леса"* - разделение области древесно-кустарниковой растительности на высотные классы по заданным порогам: по умолчанию 0-4 м, 4-10 м, 10+ м. Участки леса каждого высотного класса сохраняются в отдельных полигонах, высотный класс указывается в его свойствах (можете детальней ознакомиться с `Forest Mapping - Классификацией <https://ru.docs.mapflow.ai/docs_forest/classes.html>`_).

4. Запуск обработки
^^^^^^^^^^^^^^^^^^^^^^

 .. attention::
  После выбора всех параметров обработки отображается общая стоимость для выбранных данных. При регистрации вы бесплатно получаете 500 кредитов для тестирования платформы (:doc:`См. тарифный план <prices>`).


Работа с результатами обработки
--------------------------------

Результаты обработки сохраняются во вкладке "История обработок". 
При открытии данной вкладки – отображается статус, а также подсвечиваются выбранные ранее параметры обработки, в основном окне.

 .. figure:: _static/preview_button.png
   :alt: Preview results
   :align: center
   :width: 9cm

После завершения обработки, вы можете посмотреть результаты на интерактивной карте или скачать их в виде векторных геоданных (GeoJSON).

 .. note::
  - Кнопка "Дублировать" во вкладке "История обработок" позволяет запускать обработки с теми же параметрами (при повторном запуске с теми же параметрами - запускается новая обработка);
  - Кнопка "Подробности" позволяет просматривать информацию об источнике обработки, такую, как *Область обработки* в формате geojson и *Cсылку на источник данных*.

Варианты отображения результатов обработки:

1. Скачать GeoJSON.

2. "Открыть в geojson.io" - просмотр результатов во внешнем приложении по прямой ссылке из Mapflow `(пример) <http://geojson.io/#data=data:application/json,%7B%22type%22%3A%20%22Polygon%22%2C%20%22coordinates%22%3A%20%5B%20%5B%20%5B%2037.490057513654946%2C%2055.923029653520395%20%5D%2C%20%5B%2037.490057513654946%2C%2055.949815087874605%20%5D%2C%20%5B%2037.543082024840288%2C%2055.949815087874605%20%5D%2C%20%5B%2037.543082024840288%2C%2055.923029653520395%20%5D%2C%20%5B%2037.490057513654946%2C%2055.923029653520395%20%5D%20%5D%20%5D%7D>`_.  

 .. note:: 
  Так же, перейдя ссылке `geojson.io <http://geojson.io/#data=data:application/json,%7B%22type%22%3A%20%22Polygon%22%2C%20%22coordinates%22%3A%20%5B%20%5B%20%5B%2037.490057513654946%2C%2055.923029653520395%20%5D%2C%20%5B%2037.490057513654946%2C%2055.949815087874605%20%5D%2C%20%5B%2037.543082024840288%2C%2055.949815087874605%20%5D%2C%20%5B%2037.543082024840288%2C%2055.923029653520395%20%5D%2C%20%5B%2037.490057513654946%2C%2055.923029653520395%20%5D%20%5D%20%5D%7D>`_, вы можете сохранить полученные результаты в других форматах (CSV, KML, GeoJSON, TopoJSON, WKT, Shapefile). Для этого в строке меню выберите Save и нужный вам формат.

 .. figure:: _static/geojson.io.png
  :alt: Preview map
  :align: center
  :width: 15cm

3. "Посмотреть на карте" показывает результат обработки поверх исходного изображения. Это самый быстрый способ посмотреть результаты.

 .. figure:: _static/preview_map.png
  :alt: Preview map
  :align: center
  :width: 15cm

4. "Открыть в `kepler.gl <https://kepler.geoalert.io/>`_" - просмотр результатов при помощи веб-инструмента с открытым исходным кодом, разработанным в компании Uber. Это простой, но мощный инструмент, позволяющий отображать и исследовать наборы геоданных.

 .. figure:: _static/kepler_gl.png
  :alt: Preview map
  :align: center
  :width: 15cm

 .. note:: 
  Подробную информацию о kepler.gl вы можете найти в :doc:`нашем руководстве пользователя <../docs_kepler>` или `официальном руководстве kepler.gl <https://docs.kepler.gl/docs/user-guides/j-get-started>`_.

Работа с API
------------

Mapflow предоставляет сервис **Rest API**, чтобы запускать обработки и получать результаты из внешних приложений, таких как :doc:`плагин для QGIS <../docs_api/qgis_mapflow>`.
Если вы разрабатываете собственное приложение - посмотрите документацию для разработчиков - `API обработки данных <https://ru.docs.mapflow.ai/docs_api/processing_api.html>`_.

.. important::
  При загрузке собственных изображений для обработки через API   платформы Mapflow необходимо следовать требованиям, указанным на странице с :doc:`описанием моделей <pipelines>`. Запрос с помощью по предобработке данных отправляйте на help@geoalert.io

В сервисе используется тип авториазции **Basic Auth** - используйте логин Mapflow и API token, который нужно сгенерировать в настройках профифля `во вкладке API <https://app.mapflow.ai/account/api>`_. 

 .. figure:: _static/api_tab.png
   :alt: API tab
   :align: center
   :width: 15cm


