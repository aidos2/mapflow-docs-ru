
Пользовательский интерфейс web-приложения Mapflow 
===================================================

Откройте web-приложение `Mapflow <https://app.mapflow.ai>`_. Зарегистрируйтесь или войдите используя свой Google аккаунт.

Как запускать обработку 
------------------------

Пользоваться платформой просто. Ниже отражен и описан пошаговый процесс запуска обработки: 

.. figure:: _static/ui_flow_basic.png
  :alt: UI Mapflow – run flow
  :align: center
  :width: 15cm

1. Источник данных
   
 1.1. Выбор источника данных
   
   - Default

    По умолчанию Mapflow использует спутниковые снимки `Mapbox Satellite <https://mapbox.com/maps/s satellite>`_. Вы можете загрузить собственный файл в формате `GeoJSON <https://geojson.org>`_, либо нарисовать область прямо на карте («Нарисовать прямоугольник»).

   - URL
   
    На данной вкладке предоставляется возможность использовать нужный вам источник данных спутниковой съемки, для этого укажите его URL-адрес, к тому же выбрать XYZ или TMS форматы предоставления, изменив положение ползунка *Отсчет Y сверху*. Так же доступен выбор необходимой проекции и зума. (На каком зуме произодится обработка в Mapflow можно посмотреть на страничке :doc:`Описание моделей <pipelines>`).


    .. figure:: _static/select_raster_source.png
     :alt: UI Mapflow – define AOI
     :align: center
     :width: 7cm

  

  1.2. Выбор области обработки

  На данной вкладке отображается тип источника данных, а так же кнопки:
  
   - изменить выбранный снимок (возвращение на предыдущий пунк);
   - переключить видимость выбранного снимка;
   - изменение прозрачности выбранного снимка.
  
  .. figure:: _static/ui_map_select_source.png
   :alt: UI Mapflow – define AOI
   :align: center
   :width: 15cm

 .. attention:: 
  На данный момент для одной обработки может быть нарисована или загружена только одна область. Если ваш GeoJSON имеет несколько областей в составе FeatureCollection, будет использована только первая из них. Если вы хотите обработать несколько областей, вы можете разделить их на отдельные файлы и запустить обработку для каждого. Пакетная обработка в данный момент доступна при использовании API платформы.

 .. important:: 
  В настоящее время, в качестве исходных данных, мы поддерживаем только RGB-снимки. Если вы хотите загрузить свой GeoTIFF используйте `Geoalert API <https://ru.docs.mapflow.ai/docs_api/processing_api.html>`_ или наш `плагин Mapflow <https://ru.docs.mapflow.ai/docs_api/qgis_mapflow.html>`_ для QGIS.
  
2. AI модель

 Выберите одну из моделей обработки (:doc:`См. описание моделей <pipelines>`).

3. Пост-обработка


 На данном шаге ресурсы Mapflow позволяют выбрать дополнительные параметры обработки. В зависимости от того, какую AI модель вы выбрали, доступны различные функции пост-обработки.
 
 Для AI модели "Здания": 
 
 * *"Классификация"* по типам зданий - типология зданий представлена основными классами: многоквартирные дома, частный сектор, промышеленные зоны, коммерческая недвижимость, иные нежилые (можете детальней ознакомиться с `Urban Mapping - Классификацией <https://ru.docs.mapflow.ai/docs_um/classes.html>`_).
 
 * *"Склейка с OSM"* - замена данных на здания с Openstreetmap по пространственному наложению. Для более наглядного визуального результата автоматические полигоны после обработки сопоставляются с полигонами зданий из OSM, а далее, путем сравнения с порогом соответствия по площади, производится замена некоторых автоматических полигонов.
 
 * *"Полигонизация"* - выделение контуров зданий и присвоение и замена сложных полигонов на геометрические примитивы.

 * *"Высоты зданий"* - Определение высоты зданий по косвенным признакам - длине тени и видимой части стены. Сдвиг на основание.

  .. important::
   Опция Высоты зданий доступна при обработке свыше 50 кв. км.

 Для AI модели "Лес": 
  
 * *"Классификация"* - hазделение области древесно-кустарниковой растительности на высотные классы по заданным порогам: по умолчанию 0-4 м, 4-10 м, 10+ м. Участки леса каждого высотного класса сохраняются в отдельных полигонах, высотный класс указывается в его свойствах (можете детальней ознакомиться с `Forest Mapping - Классификацией <https://ru.docs.mapflow.ai/docs_forest/classes.html>`_).

 Здесь вы можете выбрать дополнительные параметры обработки (например типологию зданий или их высоты).

 .. important::
  Опция "Высоты зданий" доступна при обработке свыше 50 кв. км.


4. Запуск обработки

 .. attention::
  После выбора всех параметров обработки отображается общая стоимость для выбранных данных. При регистрации вы бесплатно получаете 500 кредитов для тестирования платформы (:doc:`См. тарифный план <prices>`).


Работа с результатами обработки
--------------------------------

Результаты обработки сохраняются во вкладке "История обработок". 
При открытии данной вкладки – отображается статус, а также подсвечиваются выбранные ранее параметры обработки, в основном окне.

 .. figure:: _static/preview_button.png
   :alt: Preview results
   :align: center
   :width: 7cm

После завершения обработки, вы можете посмотреть результаты на интерактивной карте или скачать их в виде векторных геоданных (GeoJSON).

 .. important::
  Нажмите "Дублировать" во вкладке "История обработок" для запуска обработки с теми же параметрами (при повторном запуске с теми же параметрами - запускается новая обработка).

Варианты отображения результатов обработки:

1. Скачать GeoJSON.

2. "Открыть в geojson.io" - просмотр результатов во внешнем приложении по прямой ссылке из Mapflow `(пример) <http://geojson.io/#data=data:application/json,%7B%22type%22%3A%20%22Polygon%22%2C%20%22coordinates%22%3A%20%5B%20%5B%20%5B%2037.490057513654946%2C%2055.923029653520395%20%5D%2C%20%5B%2037.490057513654946%2C%2055.949815087874605%20%5D%2C%20%5B%2037.543082024840288%2C%2055.949815087874605%20%5D%2C%20%5B%2037.543082024840288%2C%2055.923029653520395%20%5D%2C%20%5B%2037.490057513654946%2C%2055.923029653520395%20%5D%20%5D%20%5D%7D>`_.  

 .. note:: 
  Так же, перейдя ссылке `geojson.io <http://geojson.io/#data=data:application/json,%7B%22type%22%3A%20%22Polygon%22%2C%20%22coordinates%22%3A%20%5B%20%5B%20%5B%2037.490057513654946%2C%2055.923029653520395%20%5D%2C%20%5B%2037.490057513654946%2C%2055.949815087874605%20%5D%2C%20%5B%2037.543082024840288%2C%2055.949815087874605%20%5D%2C%20%5B%2037.543082024840288%2C%2055.923029653520395%20%5D%2C%20%5B%2037.490057513654946%2C%2055.923029653520395%20%5D%20%5D%20%5D%7D>`_, вы можете сохранить полученные результаты в других форматах (CSV, KML, GeoJSON, TopoJSON, WKT, Shapefile). Для этого в строке меню выберите Save и нужный вам формат.

 .. figure:: _static/geojson.io.png
  :alt: Preview map
  :align: center
  :width: 15cm

3. "Посмотреть на карте" показывает результат обработки поверх исходного изображения. Это самый быстрый способ посмотреть результаты.

 .. figure:: _static/preview_map.png
  :alt: Preview map
  :align: center
  :width: 15cm

4. "Открыть в `kepler.gl <https://kepler.geoalert.io/>`_" - просмотр результатов при помощи веб-инструмента с открытым исходным кодом, разработанным в компании Uber. Это простой, но мощный инструмент, позволяющий отображать и исследовать наборы геоданных.

 .. figure:: _static/kepler_gl.png
  :alt: Preview map
  :align: center
  :width: 15cm

 .. note:: 
  Подробную информацию о kepler.gl вы можете найти в `руководстве пользователя <https://docs.kepler.gl/docs/user-guides/j-get-started>`_.

Работа с API
-------------

Mapflow предоставляет сервис Rest API, чтобы запускать обработки и получать результаты из внешних приложений.
Если вы разрабатываете приложение и хотите использовать API - посмотрите `Geoalert API <https://ru.docs.mapflow.ai/docs_api/processing_api.html>`_ и свяжитесь с нами чтобы получить данные для авторизации.

